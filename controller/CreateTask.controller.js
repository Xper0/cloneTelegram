sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ui/core/library","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/routing/History"],function(e,t,s,o,n,a,i){"use strict";let l=o.ValueState;return e.extend("cloneTelegramApp.cloneTelegram.controller.CreateTask",{onInit:async function(){var e=new s({});this._formFragments={};this.byId("edit").setEnabled(true);this._showFormFragment("addTask");this.oTaskModel=this.getOwnerComponent().getModel("ListTasks");const t="http://127.0.0.1:5000/usersList";let o=await fetch(t);let n=await o.json();this.oTaskModel.setProperty("/users",Object.assign({},n.result));console.log(this.oTaskModel)},handleEditPress:function(){this._toggleButtonsAndView(false)},handleSavePress:function(){this._toggleButtonsAndView(true)},handleCancelPress:function(){this._toggleButtonsAndView(true)},_toggleButtonsAndView:function(e){var t=this.getView();t.byId("edit").setVisible(e);t.byId("save").setVisible(!e);t.byId("cancel").setVisible(!e);this._showFormFragment(e?"addTask":"PreviewTask")},_getFormFragment:function(e){let s=this._formFragments[e],o=this.getView();if(!s){s=t.load({id:o.getId(),name:`cloneTelegramApp.cloneTelegram.view.${e}`,controller:this});this._formFragments[e]=s}return s},_showFormFragment:function(e){let t=this.byId("addTask");t.removeAllContent();this._getFormFragment(e).then(function(e){t.insertContent(e)})},handleChange:function(e){let t=e.getSource(),s=t.getSelectedKey(),o=t.getValue();console.log(s);if(!s&&o){t.setValueState(l.Error);t.setValueStateText("Please enter a valid contact!")}else{t.setValueState(l.None)}},onNameChange:function(e){let t=e.getSource();this._validateInput(t)},_validateInput:function(e){let t="None";let s=false;let o=e.getBindingInfo("value").type;console.log(o.type);try{o.validateValue(e.getValue())}catch(e){t="Error";s=true}e.setValueState(t);return s},onAddListTask:async function(){let e=this.byId("form");let t={};let s=this.byId("editFormTask");let o=s.getFormContainers()[0].getFormElements();let a=this.getView(),i=[a.byId("titleTask")],l=false;i.forEach(function(e){l=this._validateInput(e)||l},this);if(!l){let e=this.getOwnerComponent().getRouter();let s=["1513492075","730832139"];const n=" http://127.0.0.1:5000/sendMessage";let a={Accept:"application/json","Access-Control-Allow-Origin":"*","X-Requested-With":"XMLHttpRequest","Access-Control-Allow-Methods":"GET,POST,PUT,DELETE,OPTIONS","Access-Control-Allow-Headers":"Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With"};o.forEach(e=>{if(e.getLabel()==="Название задачи"){t.title=e.getFields()[0].getProperty("value")}if(e.getLabel()==="Описание задачи"){t.description=e.getFields()[0].getProperty("value")}if(e.getLabel()==="Крайний срок"){t.date=e.getFields()[0].getProperty("value")}if(e.getLabel()==="Важность"){t.importance=e.getFields()[0].getProperty("value")}if(e.getLabel()==="Постановщик"){t.supervisor=e.getFields()[0].getProperty("value")}if(e.getLabel()==="Ответсвенный"){t.responsible=e.getFields()[0].getProperty("value")}});let i=await fetch(n,{method:"POST",headers:a,body:JSON.stringify({message:t,idChat:s[0]})});let l=await i.json();console.log(l);e.navTo("Tasks")}else{n.alert("A validation error has occurred. Complete your input first.")}console.log("add task")},onNavBack:function(){let e=this.getOwnerComponent().getRouter();let t=i.getInstance().getPreviousHash();if(t!==undefined){window.history.back()}else{e.navTo("Init",{},true)}},select:function(e){console.log(e)}})});